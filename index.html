<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Aftab Store App</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.png">
<meta name="theme-color" content="#28a745">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<style>

body{
font-family:Arial;
margin:0;
background:#eef2f3;
}

header{
background:#28a745;
color:white;
padding:15px;
text-align:center;
font-size:20px;
font-weight:bold;
}

.box{
background:white;
margin:12px;
padding:15px;
border-radius:10px;
}

input,textarea,button{
width:100%;
padding:10px;
margin:6px 0;
border-radius:6px;
border:1px solid #ccc;
}

button{
background:#28a745;
color:white;
border:none;
border-radius:6px;
font-weight:bold;
}

.logout{
background:red;
}

</style>
</head>

<body>

<header>üõí Aftab Store</header>

<!-- LOGIN -->
<div id="loginBox" class="box">

<h3>Login</h3>

<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="Password">

<button onclick="login()">Login</button>

<p id="msg" style="color:red"></p>

</div>


<!-- STORE -->
<div id="storeBox" class="box" style="display:none">

<h3>Place Order</h3>

<input id="name" placeholder="Name">
<input id="mobile" placeholder="Mobile">
<textarea id="address" placeholder="Address"></textarea>

<hr>

ü•õ Milk (‚Çπ60)
<input id="m1" type="number" value="0">

üçö Rice (‚Çπ50)
<input id="r1" type="number" value="0">

<br><br>

<button onclick="sendOrder()">Order on WhatsApp</button>

<button class="logout" onclick="logout()">Logout</button>

</div>


<script>

/* FIREBASE CONFIG */
firebase.initializeApp({
apiKey: "AIzaSyA8O4kOinBczBQ8r9mbtOdH98X70ezpgYk",
authDomain: "new-prototype-s7zo4.firebaseapp.com",
projectId: "new-prototype-s7zo4"
});

const auth = firebase.auth();
const db = firebase.firestore();


/* AUTO LOGIN */
auth.onAuthStateChanged(async user=>{

if(user){

let doc = await db.collection("Users").doc(user.uid).get();

if(doc.exists && doc.data().status==="Blocked"){

await auth.signOut();
msg.innerText="Account Blocked ‚ùå";
return;

}

showStore();

}

});


/* SHOW STORE */
function showStore(){

loginBox.style.display="none";
storeBox.style.display="block";

}


/* LOGIN */
async function login(){

let email = document.getElementById("email").value.trim();
let pass  = document.getElementById("pass").value.trim();

if(!email || !pass){
msg.innerText="Fill all fields";
return;
}

try{

let res = await auth.signInWithEmailAndPassword(email,pass);

let doc = await db.collection("Users").doc(res.user.uid).get();

if(doc.exists && doc.data().status==="Blocked"){

await auth.signOut();
msg.innerText="Account Blocked ‚ùå";
return;

}

showStore();

}catch{

msg.innerText="Wrong Email / Password";

}

}


/* LOGOUT */
function logout(){

auth.signOut();

loginBox.style.display="block";
storeBox.style.display="none";

}


/* ORDER */
function sendOrder(){

let name    = document.getElementById("name").value.trim();
let mobile  = document.getElementById("mobile").value.trim();
let address = document.getElementById("address").value.trim();

let m1 = document.getElementById("m1").value;
let r1 = document.getElementById("r1").value;

if(!name || !mobile || !address){
alert("Fill all details");
return;
}

if(m1==0 && r1==0){
alert("Select at least 1 item");
return;
}

let msg =
"üõí New Order%0A%0A"+
"üë§ Name: "+name+"%0A"+
"üì± Mobile: "+mobile+"%0A"+
"üè† Address: "+address+"%0A%0A"+
"ü•õ Milk: "+m1+"%0A"+
"üçö Rice: "+r1;

window.open("https://wa.me/919336678937?text="+msg);

}

</script>

</body>
</html>
