<!DOCTYPE html>
<html>
<head>

<title>Mumbai Elite | Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- ‚úÖ PWA + ICON -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0072bc">
<link rel="apple-touch-icon" href="icon.png">

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<style>

body{
font-family:Arial;
background:linear-gradient(135deg,#0072bc,#00c6ff);
display:flex;
justify-content:center;
align-items:center;
height:100vh;
margin:0;
}

/* LOGIN BOX */
.box{
background:white;
padding:25px;
width:320px;
border-radius:12px;
text-align:center;
box-shadow:0 10px 25px rgba(0,0,0,0.3);
}

h2{margin-bottom:15px}

/* INPUT */
input{
width:100%;
padding:12px;
margin:8px 0;
border-radius:6px;
border:1px solid #ccc;
font-size:14px;
}

/* BUTTON */
button{
width:100%;
padding:12px;
background:#0072bc;
color:white;
border:none;
border-radius:6px;
font-weight:bold;
cursor:pointer;
font-size:15px;
}

button:disabled{
background:#999;
}

/* MSG */
#msg{
margin-top:10px;
font-size:13px;
color:red;
}

/* LINK */
a{
display:block;
margin-top:12px;
color:#0072bc;
font-size:14px;
text-decoration:none;
}

.loading{
color:green;
}

</style>
</head>

<body>

<div class="box">

<h2>üîê Mumbai Elite Login</h2>

<input type="email" id="loginEmail" placeholder="Email">

<input type="password" id="loginPass" placeholder="Password">

<button id="loginBtn" onclick="handleLogin()">Login</button>

<p id="msg"></p>

<a href="register.html">Create New Account</a>

</div>


<script>

/* FIREBASE CONFIG */
const firebaseConfig = {
apiKey: "AIzaSyA8O4kOinBczBQ8r9mbtOdH98X70ezpgYk",
authDomain: "new-prototype-s7zo4.firebaseapp.com",
projectId: "new-prototype-s7zo4"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();


/* AUTO LOGIN */
auth.onAuthStateChanged(user=>{

if(user){
checkUser(user.uid);
}

});


/* LOGIN */
async function handleLogin(){

let email=loginEmail.value.trim();
let pass=loginPass.value.trim();

if(!email||!pass){
msg.innerText="Fill all fields";
return;
}

loginBtn.disabled=true;
msg.innerHTML="<span class='loading'>Logging in...</span>";

try{

let cred=await auth.signInWithEmailAndPassword(email,pass);

checkUser(cred.user.uid);

}catch(e){

msg.innerText="Wrong Email or Password";
loginBtn.disabled=false;

}

}


/* CHECK ROLE */
async function checkUser(uid){

try{

let doc=await db.collection("Users").doc(uid).get();

if(!doc.exists){
msg.innerText="No profile found";
return;
}

let data=doc.data();


/* BLOCK CHECK */
if(data.status==="Blocked"){
await auth.signOut();
msg.innerText="Account Blocked ‚ùå";
loginBtn.disabled=false;
return;
}


/* REDIRECT */
if(data.role==="admin"){
location="admin.html";
}
else{
location="dashboard.html";
}

}catch{

msg.innerText="Server Error";
loginBtn.disabled=false;

}

}

</script>

</body>
</html>
