<!DOCTYPE html>
<html>
<head>
<title>Mumbai Elite | Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
font-family:Arial;
background:#eef2f5;
margin:0;
}

/* HEADER */
header{
background:#0072bc;
color:white;
padding:15px;
text-align:center;
font-size:20px;
font-weight:bold;
}

/* BOX */
.box{
background:white;
margin:12px;
padding:15px;
border-radius:12px;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.profile{
display:flex;
align-items:center;
gap:10px;
}

/* FORM */
input,button{
width:100%;
padding:10px;
margin:6px 0;
border-radius:6px;
border:1px solid #ccc;
}

button{
background:#0072bc;
color:white;
border:none;
font-weight:bold;
cursor:pointer;
}

button:hover{opacity:0.9}

.logout{background:red}

/* POST */
.post{
border:1px solid #ddd;
padding:10px;
margin:12px 0;
border-radius:10px;
}

.post img{
width:100%;
border-radius:8px;
margin:5px 0;
}

.post small{
color:#666;
}

.actions{
display:flex;
justify-content:space-between;
margin-top:5px;
}

.like{
color:#0072bc;
cursor:pointer;
font-size:14px;
}

.delete{
color:red;
cursor:pointer;
font-size:13px;
}

.preview{
width:100%;
max-height:200px;
object-fit:cover;
border-radius:8px;
display:none;
margin:5px 0;
}

</style>
</head>

<body>

<header>üì∏ Mumbai Elite Feed</header>


<!-- PROFILE -->
<div class="box">

<div class="profile">
<h3 id="username">Loading...</h3>
<small id="userRole"></small>
</div>

</div>


<!-- CREATE POST -->
<div class="box">

<h3>Create Post</h3>

<input type="file" id="postImage" accept="image/*" onchange="previewImg()">

<img id="preview" class="preview">

<input id="caption" placeholder="Write caption...">

<button onclick="uploadPost()">Post</button>

</div>


<!-- FEED -->
<div class="box">

<h3>Latest Feed</h3>

<div id="feed">Loading...</div>

</div>


<!-- LOGOUT -->
<div class="box">

<button class="logout" onclick="logout()">Logout</button>

</div>


<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>


<script>

/* CONFIG */
const firebaseConfig = {
apiKey: "AIzaSyA8O4kOinBczBQ8r9mbtOdH98X70ezpgYk",
authDomain: "new-prototype-s7zo4.firebaseapp.com",
projectId: "new-prototype-s7zo4",
storageBucket: "new-prototype-s7zo4.appspot.com"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

let currentUser=null;


/* AUTH CHECK */
auth.onAuthStateChanged(user=>{

if(!user){
location="index.html";
return;
}

currentUser=user;

loadProfile();
loadPosts();

});


/* PROFILE */
async function loadProfile(){

let doc=await db.collection("Users").doc(currentUser.uid).get();

if(doc.exists){

username.innerText="üë§ "+doc.data().name;
userRole.innerText="("+doc.data().role+")";

}

}


/* PREVIEW */
function previewImg(){

let file=postImage.files[0];

if(file){
preview.src=URL.createObjectURL(file);
preview.style.display="block";
}

}


/* UPLOAD */
async function uploadPost(){

let file=postImage.files[0];
let caption=caption.value;

if(!file){
alert("Select image");
return;
}

let ref=storage.ref("posts/"+Date.now()+file.name);

await ref.put(file);

let url=await ref.getDownloadURL();

await db.collection("Posts").add({

uid:currentUser.uid,
image:url,
caption:caption,
likes:0,
time:firebase.firestore.FieldValue.serverTimestamp()

});

alert("Posted ‚úÖ");

postImage.value="";
caption.value="";
preview.style.display="none";

loadPosts();

}


/* LOAD POSTS */
async function loadPosts(){

let feed=document.getElementById("feed");

feed.innerHTML="Loading...";

let snap=await db.collection("Posts")
.orderBy("time","desc")
.get();

feed.innerHTML="";

snap.forEach(doc=>{

let p=doc.data();

feed.innerHTML+=`

<div class="post">

<small>üë§ ${p.uid}</small>

<img src="${p.image}">

<p>${p.caption||""}</p>

<div class="actions">

<span class="like" onclick="likePost('${doc.id}',${p.likes||0})">
‚ù§Ô∏è ${p.likes||0}
</span>

${p.uid===currentUser.uid?
`<span class="delete" onclick="deletePost('${doc.id}','${p.image}')">
üóë Delete
</span>`:""}

</div>

</div>

`;

});

}


/* LIKE */
async function likePost(id,count){

await db.collection("Posts").doc(id).update({
likes:count+1
});

loadPosts();

}


/* DELETE */
async function deletePost(id,url){

if(!confirm("Delete post?"))return;

await db.collection("Posts").doc(id).delete();

let ref=storage.refFromURL(url);

await ref.delete();

loadPosts();

}


/* LOGOUT */
function logout(){

auth.signOut().then(()=>{
location="index.html";
});

}

</script>

</body>
</html>
