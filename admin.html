<!DOCTYPE html>
<html>
<head>
<title>Admin Panel | Aftab Store</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<style>

body{
font-family:Arial;
margin:0;
background:#111;
color:#fff;
}

/* BOX */
.box{
width:100%;
max-width:500px;
min-height:100vh;
margin:auto;
background:#fff;
color:#000;
padding:15px;
box-sizing:border-box;
}

/* INPUT */
input,button{
width:100%;
padding:12px;
margin:6px 0;
border-radius:6px;
border:1px solid #ccc;
font-size:15px;
}

/* BUTTON */
button{
background:#28a745;
color:white;
border:none;
cursor:pointer;
font-weight:bold;
}

button:hover{opacity:.9}

.red{background:red}

/* LIST */
.item{
border:1px solid #ddd;
padding:8px;
margin:6px 0;
border-radius:6px;
display:flex;
justify-content:space-between;
align-items:center;
font-size:14px;
}

.orderBox{
border:1px solid #ccc;
padding:8px;
margin:8px 0;
border-radius:6px;
font-size:13px;
}

</style>
</head>

<body>

<!-- LOGIN -->
<div class="box" id="loginBox">

<h2>ğŸ” Admin Login</h2>

<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="Password">

<button onclick="login()">Login</button>

<p id="msg" style="color:red"></p>

</div>


<!-- PANEL -->
<div class="box" id="panel" style="display:none">

<h2>ğŸ“¦ Admin Dashboard</h2>

<hr>

<h3>Add Product</h3>

<input id="pname" placeholder="Product Name">
<input id="price" type="number" placeholder="Price â‚¹">
<input id="stock" type="number" placeholder="Stock">

<button onclick="addProduct()">â• Add</button>

<hr>

<h3>Products</h3>
<div id="products">Loading...</div>

<hr>

<h3>Orders</h3>
<div id="orders">Loading...</div>

<hr>

<button class="red" onclick="logout()">Logout</button>

</div>


<script>

/* FIREBASE CONFIG */
firebase.initializeApp({
apiKey: "AIzaSyA8O4kOinBczBQ8r9mbtOdH98X70ezpgYk",
authDomain: "new-prototype-s7zo4.firebaseapp.com",
projectId: "new-prototype-s7zo4"
});

const auth = firebase.auth();
const db = firebase.firestore();


/* AUTO LOGIN */
auth.onAuthStateChanged(async user=>{

if(!user) return;

let doc = await db.collection("Users").doc(user.uid).get();

if(!doc.exists || doc.data().role!=="admin"){

alert("Not Admin âŒ");
auth.signOut();
return;

}

loginBox.style.display="none";
panel.style.display="block";

loadProducts();
loadOrders();

});


/* LOGIN */
async function login(){

msg.innerText="";

try{

let cred = await auth.signInWithEmailAndPassword(
email.value.trim(),
pass.value.trim()
);

let doc = await db.collection("Users")
.doc(cred.user.uid).get();

if(!doc.exists || doc.data().role!=="admin"){

msg.innerText="Not Admin Account âŒ";
auth.signOut();
return;

}

loginBox.style.display="none";
panel.style.display="block";

loadProducts();
loadOrders();

}catch{

msg.innerText="Wrong Email / Password";

}

}


/* LOGOUT */
function logout(){

auth.signOut();
location.reload();

}


/* ADD PRODUCT */
async function addProduct(){

if(!pname.value||!price.value||!stock.value)
return alert("Fill All Fields");

await db.collection("Products").add({

name:pname.value,
price:Number(price.value),
stock:Number(stock.value),
time:firebase.firestore.FieldValue.serverTimestamp()

});

pname.value="";
price.value="";
stock.value="";

loadProducts();

alert("Product Added âœ…");

}


/* LOAD PRODUCTS */
async function loadProducts(){

let snap = await db.collection("Products")
.orderBy("time","desc").get();

products.innerHTML="";

if(snap.empty){
products.innerHTML="No Products";
return;
}

snap.forEach(d=>{

let p = d.data();

products.innerHTML+=`

<div class="item">

<span>
${p.name} â‚¹${p.price}
(Stock:${p.stock})
</span>

<button onclick="del('${d.id}')">âŒ</button>

</div>

`;

});

}


/* DELETE */
async function del(id){

if(!confirm("Delete Product?")) return;

await db.collection("Products").doc(id).delete();

loadProducts();

}


/* LOAD ORDERS */
async function loadOrders(){

let snap = await db.collection("Orders")
.orderBy("time","desc").get();

orders.innerHTML="";

if(snap.empty){
orders.innerHTML="No Orders";
return;
}

snap.forEach(d=>{

let o=d.data();

orders.innerHTML+=`

<div class="orderBox">

<b>${o.name}</b><br>
ğŸ“± ${o.mobile}<br>
ğŸ  ${o.address}<br><br>

${o.items}<br>

ğŸ’° â‚¹${o.total}

</div>

`;

});

}

</script>

</body>
</html>
