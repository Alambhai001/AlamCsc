<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mumbai Elite | Admin Panel</title>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root{--blue:#0072bc;--orange:#f37021;--green:#2e7d32;--red:#d32f2f}

body{
font-family:Arial;
margin:0;
background:#111;
color:#fff;
}

/* LOGIN */
#loginBox{
max-width:350px;
margin:120px auto;
background:white;
color:#333;
padding:25px;
border-radius:12px;
text-align:center;
}

#loginBox input{
width:100%;
padding:10px;
margin:8px 0;
border-radius:6px;
border:1px solid #ccc;
}

/* HEADER */
.admin-header{
background:#000;
padding:15px 5%;
display:flex;
justify-content:space-between;
align-items:center;
}

/* STATS */
.stats-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
gap:12px;
padding:15px 5%;
}

.stat-card{
background:white;
color:#333;
padding:15px;
border-radius:10px;
text-align:center;
}

/* FORM */
.quick-add{
background:white;
color:#333;
margin:20px 5%;
padding:20px;
border-radius:12px;
}

.form-row{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
gap:10px;
}

input,select{
padding:10px;
border-radius:6px;
border:1px solid #ccc;
}

.btn-add{
background:var(--green);
color:white;
border:none;
padding:12px;
border-radius:6px;
font-weight:bold;
cursor:pointer;
}

/* TABLE */
.table-container{
margin:20px 5%;
background:white;
color:#333;
border-radius:12px;
overflow:auto;
}

table{
width:100%;
border-collapse:collapse;
min-width:800px;
}

th,td{
padding:12px;
border-bottom:1px solid #eee;
font-size:13px;
}

th{
background:#f5f5f5;
}

.btn{
padding:6px 10px;
border:none;
border-radius:5px;
font-size:11px;
cursor:pointer;
}

.btn-block{background:var(--orange);color:white}
.btn-unblock{background:var(--green);color:white}
.btn-delete{background:var(--red);color:white}

</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">

<h2>üîê Admin Login</h2>

<input id="adminEmail" placeholder="Email">
<input id="adminPass" type="password" placeholder="Password">

<button onclick="adminLogin()"
style="width:100%;padding:10px;background:#0072bc;color:white;border:none;border-radius:6px">
LOGIN
</button>

<p id="loginMsg" style="color:red;font-size:13px"></p>

</div>


<!-- ADMIN PANEL -->
<div id="adminPanel" style="display:none">

<div class="admin-header">
<h2>üèôÔ∏è Mumbai Elite Admin</h2>
<button onclick="logout()" class="btn" style="background:red;color:white">LOGOUT</button>
</div>


<div class="stats-grid">

<div class="stat-card">
<b id="countAll">0</b><br>Total Users
</div>

<div class="stat-card">
<b id="countPartner" style="color:var(--orange)">0</b><br>Partners
</div>

<div class="stat-card">
<b id="countCitizen" style="color:var(--green)">0</b><br>Citizens
</div>

</div>


<div class="quick-add">

<h3>‚ûï Add User</h3>

<div class="form-row">

<input id="addName" placeholder="Name">
<input id="addEmail" placeholder="Email">
<input id="addPass" type="password" placeholder="Password">
<input id="addPhone" placeholder="Phone">

<select id="addRole">
<option value="citizen">Citizen</option>
<option value="partner">Partner</option>
</select>

<button class="btn-add" onclick="forceAddUser()">ADD</button>

</div>

</div>


<div class="table-container">

<table>
<thead>
<tr>
<th>Name</th>
<th>Role</th>
<th>Status</th>
<th>Block</th>
<th>Action</th>
</tr>
</thead>

<tbody id="userList"></tbody>

</table>

</div>

</div>


<script>

/* FIREBASE */
const firebaseConfig = {
apiKey: "AIzaSyA8O4kOinBczBQ8r9mbtOdH98X70ezpgYk",
authDomain: "new-prototype-s7zo4.firebaseapp.com",
projectId: "new-prototype-s7zo4",
storageBucket: "new-prototype-s7zo4.firebasestorage.app",
messagingSenderId: "406938721232",
appId: "1:406938721232:web:abfd93d796d2d37c5af7d5"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();


/* LOGIN */
function adminLogin(){

let email=adminEmail.value;
let pass=adminPass.value;

auth.signInWithEmailAndPassword(email,pass)
.then(()=>{

loginBox.style.display="none";
adminPanel.style.display="block";

loadUsers();

})
.catch(()=>{
loginMsg.innerText="Wrong Email / Password";
});

}

function logout(){
auth.signOut();
location.reload();
}


auth.onAuthStateChanged(user=>{

if(user){
loginBox.style.display="none";
adminPanel.style.display="block";
loadUsers();
}

});


/* ADD USER */
async function forceAddUser(){

let name=addName.value;
let email=addEmail.value;
let pass=addPass.value;
let phone=addPhone.value;
let role=addRole.value;

if(!name||!email||!pass||!phone){
alert("Fill all fields");
return;
}

try{

let user=await auth.createUserWithEmailAndPassword(email,pass);

await db.collection("Users").doc(user.user.uid).set({

name,email,phone,role,
status:"Active",
time:firebase.firestore.FieldValue.serverTimestamp()

});

alert("User Added");

loadUsers();

}catch(e){
alert(e.message);
}

}


/* LOAD USERS */
async function loadUsers(){

let snap=await db.collection("Users").get();

userList.innerHTML="";

let p=0,c=0;

snap.forEach(doc=>{

let d=doc.data();

if(d.role=="partner")p++;
else c++;

userList.innerHTML+=`

<tr>

<td>${d.name}<br><small>${d.phone}</small></td>

<td>${d.role}</td>

<td>${d.status}</td>

<td>${d.blockUntil?new Date(d.blockUntil.seconds*1000).toLocaleDateString():"-"}</td>

<td>

<button class="btn btn-block" onclick="blockUser('${doc.id}')">Block</button>

<button class="btn btn-unblock" onclick="unblockUser('${doc.id}')">Unblock</button>

<button class="btn btn-delete" onclick="deleteUser('${doc.id}')">Delete</button>

</td>

</tr>

`;

});

countAll.innerText=p+c;
countPartner.innerText=p;
countCitizen.innerText=c;

}


/* ACTIONS */

async function blockUser(id){

let d=prompt("Days to block?");

if(!d)return;

let dt=new Date();
dt.setDate(dt.getDate()+parseInt(d));

await db.collection("Users").doc(id).update({

status:"Blocked",
blockUntil:dt

});

loadUsers();

}

async function unblockUser(id){

await db.collection("Users").doc(id).update({

status:"Active",
blockUntil:null

});

loadUsers();

}

async function deleteUser(id){

if(confirm("Delete User?")){

await db.collection("Users").doc(id).delete();
loadUsers();

}

}

</script>

</body>
</html>
